var wceb={productType:wceb_object.product_type,calcMode:wceb_object.calc_mode,maxOption:new Date(wceb_object.last_date+"T00:00:00"),firstWeekday:wceb_object.first_weekday,allowDisabled:wceb_object.allow_disabled,session:!1,checkIf:{isDate:null,isDay:null,isArray:null,isObject:null,isDisabled:null,dateIsSet:null,datesAreSet:null},get:{firstAvailableDate:null,basePrice:null,additionalCosts:null,childrenIds:null,minAndMax:null,closestDisabled:null,closest:null},createDateObject:null,clearBookingSession:null,applyBookingDuration:null,formatPrice:null,setPrice:null,picker:{close:null,set:null},pickers:{init:null,render:null,reset:null,clearSecond:null,set:null}};!function(p){p(document).ready(function(){ajax_url=("https:"===location.protocol?"https:":"http:")+wceb_object.ajax_url,$body=p("body"),$cart=p(".cart"),$qty_input=$cart.find('input[name="quantity"]'),$booking_price=p(".booking_price"),$add_to_cart_button=p(".single_add_to_cart_button"),$reset_dates=p("a.reset_dates"),product_id=p('input[name="add-to-cart"], button[name="add-to-cart"]').val(),$variation_input=p(".variations_form").find('input[name="variation_id"]'),$inputStart=p(".datepicker_start").pickadate(),pickerStart=$inputStart.pickadate("picker"),pickerStartItem=pickerStart.component.item,$inputEnd=p(".datepicker_end").pickadate(),pickerEnd=$inputEnd.pickadate("picker"),pickerEndItem=pickerEnd.component.item;var a={startFormat:null,endFormat:null};wceb.checkIf.isDate=function(e){return e instanceof Date},wceb.checkIf.isDay=function(e){return!isNaN(e)&&1<=e&&e<=7},wceb.checkIf.isArray=function(e){return e instanceof Array},wceb.checkIf.isObject=function(e){return"object"==typeof e&&!(e instanceof Date)},wceb.checkIf.isDisabled=function(e,r){if(void 0===e)return!1;var c=!1,i=r.pick;return p.each(e,function(e,t){if(wceb.checkIf.isArray(t)){if(t=new Date(t[0],t[1],t[2]),i===t.getTime())return void(c=!0)}else if(wceb.checkIf.isObject(t)){if(start=new Date(t.from[0],t.from[1],t.from[2]),end=new Date(t.to[0],t.to[1],t.to[2]),i>=start.getTime()&&i<=end.getTime())return void(c=!0)}else if(wceb.checkIf.isDay(t)){var a=r.day;if("1"===wceb.firstWeekday&&0===a?a=7:"1"!==wceb.firstWeekday&&(a+=1),t===a)return void(c=!0)}else if(wceb.checkIf.isDate(t)&&i===t.getTime())return void(c=!0)}),c},wceb.checkIf.dateIsSet=function(e){if("start"===e)e=pickerStart.get("select");else if("end"===e)e=pickerEnd.get("select");return null!=e},wceb.checkIf.datesAreSet=function(){var e=pickerStart.get("select"),t=pickerEnd.get("select");return null!=e&&null!=t},wceb.get.firstAvailableDates=function(){var e={};if((t=+parseInt(wceb.firstDate))<=0)var t=!1;for(var a=wceb.createDateObject(!1,t),r=pickerStartItem.disable;!0===wceb.checkIf.isDisabled(r,a);)a=wceb.createDateObject(a.obj,1);if(e.start=a,"two"===wceb.dateFormat){for(var c=new Date(a.pick),i=wceb.createDateObject(c,wceb.bookingMin),n=pickerEndItem.disable;!0===wceb.checkIf.isDisabled(n,i);)i=wceb.createDateObject(i.obj,1);e.end=i}return e},wceb.get.basePrice=function(){var e=parseFloat($booking_price.attr("data-booking_price"));if("two"===wceb.dateFormat&&!wceb.checkIf.datesAreSet()||"one"===wceb.dateFormat&&!wceb.checkIf.dateIsSet("start"))var t=$qty_input.length?parseFloat($qty_input.val()):1,a=wceb.get.additionalCosts(),r=parseFloat((a+e)*t);else r=e;return r},wceb.get.regularPrice=function(){var e=parseFloat($booking_price.attr("data-booking_regular_price"));if("two"===wceb.dateFormat&&!wceb.checkIf.datesAreSet()||"one"===wceb.dateFormat&&!wceb.checkIf.dateIsSet("start"))var t=$qty_input.length?parseFloat($qty_input.val()):1,a=wceb.get.additionalCosts(),r=parseFloat((a+e)*t);else r=e;return r},wceb.get.additionalCosts=function(e,d){if(void 0===d)d="price";var l=0,b={};return $selector="bundle"===wceb.productType&&"each"===e?p(".product").find("form.cart").find(".cart"):"bundle"===wceb.productType&&"each"!==e?p(".product").find(".cart.bundle_data"):p(".product").find("form.cart"),$selector.each(function(){p(this).find(".addon, .wc-pao-addon-field").each(function(){var e=0,t=p(this),a=t.parents(".cart");if(void 0!==a.data("bundle_id"))var r=a.data("product_id"),c=a.data("bundled_item_id");if(t.is(".addon-custom-price, .wc-pao-addon-custom-price"))e=t.val();else if(t.is(".addon-input_multiplier, .wc-pao-addon-input-multiplier"))isNaN(t.val())||""==t.val()?(t.val(""),t.closest("p").find(".addon-alert").show()):(""!=t.val()&&t.val(Math.ceil(t.val())),t.closest("p").find(".addon-alert").hide()),e=t.data(d)*t.val();else if(t.is(".addon-checkbox, .wc-pao-addon-checkbox, .addon-radio, .wc-pao-addon-radio"))t.is(":checked")&&(e=t.data(d));else if(t.is(".addon-select, .wc-pao-addon-select, .wc-pao-addon-image-swatch-select")){if(t.val()){var i=t.prop("selectedIndex")-1;e=t.find("option:selected").data(d)}}else t.val()&&(e=t.data(d));if(l+=e=e||0,void 0===r){var n=$variation_input.val();r=void 0!==n?n:product_id}if(void 0!==r&&""!==r&&""!=t.val()){var o=t.attr("name").replace(/ *\[[^\]]*]/,"").replace("addon-","");if(void 0!==c)o=o.replace(c+"-",r+"-");if(void 0!==i){var s={};s[i]=e,b[o]=s}else b.hasOwnProperty(o)?b[o].push(e):b[o]=[e]}})}),"each"===e?b:l},wceb.get.childrenIds=function(){var a={};if("grouped"===wceb.productType){var e=wceb_object.children;p.each(e,function(e,t){$child_input=p('input[name="quantity['+t+']"]'),quantity=$child_input.is(".wc-grouped-product-add-to-cart-checkbox")?$child_input.is(":checked")?1:0:$child_input.val(),0<quantity&&(a[t]=quantity)})}else if("bundle"===wceb.productType){var t=p(".cart.bundle_data"),r=t.data("bundle_id");if(t.find('input[name="quantity"]').length)var c=t.find('input[name="quantity"]').val();else c=1;a[r]=c,$body.find(".bundled_product .cart").each(function(){$this=p(this),optional=$this.data("optional"),bundle=$this.data("bundled_item_id"),child=$this.data("product_id"),variation=$this.find('input[name="bundle_variation_id_'+bundle+'"]').val(),quantity=$this.find(".bundled_qty").val();var e="undefined"==typeof variation?child:variation;"yes"===optional&&!1===p('input[name="bundle_selected_optional_'+bundle+'"]').is(":checked")&&(quantity=0);""!==e&&0<quantity&&(a[e]=quantity)})}return a},wceb.get.minAndMax=function(e,t){var a=new Date(e.year,e.month,e.date),r=new Date(e.year,e.month,e.date),c=wceb.get.firstAvailableDates(),i="minus"===t?c.start.obj:c.end.obj;if("minus"===t&&""===wceb.bookingMax)a=i;"plus"===t?(a.setDate(a.getDate()+wceb.bookingMin),""!==wceb.bookingMax&&r.setDate(r.getDate()+wceb.bookingMax)):(r.setDate(r.getDate()-wceb.bookingMin),""!==wceb.bookingMax&&a.setDate(a.getDate()-wceb.bookingMax)),a<i&&(a=i),"plus"===t&&""===wceb.bookingMax&&(r=!1),(!r||wceb.maxOption<r)&&(r=wceb.maxOption);var n={};return n.min=a,n.max=r,n},wceb.get.closestDisabled=function(i,e,n){var o=new Date(i),s=o.getDay(),t=e.get("disable"),d=[];return p.each(t,function(e,t){if(wceb.checkIf.isArray(t)){if("booked"===t.type||"no"===wceb.allowDisabled){var a=new Date(t[0],t[1],t[2]);d.push(a.getTime())}}else if(wceb.checkIf.isObject(t)){if("superior"===n)a=new Date(t.from[0],t.from[1],t.from[2]);else a=new Date(t.to[0],t.to[1],t.to[2]);"booked"!==t.type&&"no"!==wceb.allowDisabled||d.push(a.getTime())}else if(wceb.checkIf.isDate(t))d.push(t.getTime());else if("no"===wceb.allowDisabled&&wceb.checkIf.isDay(t))if("superior"===n){0===(c=Math.abs(s-t))&&(c=7),t<s&&7!==c&&(c=7-c);var r=o.setDate(o.getDate()+c);d.push(r),o=new Date(i)}else if("inferior"===n){var c;0===(c=Math.abs(s-t))&&(c=7),s<t&&7!==c&&(c=7-c),previousDisabledDay=o.setDate(o.getDate()-c),d.push(previousDisabledDay)}}),d.sort(),wceb.get.closest(d,i,n)},wceb.get.closest=function(e,t,a){minClosest=!1;for(var r=0;r<e.length;r++)if("superior"===a){if(e[r]>t){minClosest=e[r];break}minClosest=!1}else"inferior"===a&&e[r]<t&&(minClosest=e[r]);return minClosest},wceb.createDateObject=function(e,t){var a={};if(!e)e=new Date;return t&&e.setDate(e.getDate()+t),"infinity"===e?a={date:1/0,day:1/0,month:1/0,obj:1/0,pick:1/0,year:1/0}:wceb.checkIf.isDate(e)?(e.setHours(0,0,0,0),a={date:e.getDate(),day:e.getDay(),month:e.getMonth(),obj:e,pick:e.getTime(),year:e.getFullYear()}):a},wceb.clearBookingSession=function(){if(wceb.session){var e={security:document.getElementsByName("_wceb_nonce")[0].value};p.post(ajax_url.toString().replace("%%endpoint%%","clear_booking_session"),e,function(){wceb.session=!1})}$booking_price.find(".price").html(""),p(".booking_details").html(""),$add_to_cart_button.addClass("disabled dates-selection-needed")},wceb.applyBookingDuration=function(e,t,a){var r,c=t.disable,i="end"===e?t.max:t.min,n=new Date(a.year,a.month,a.date),o=t.view,s=new Date(o.year,o.month,0).getDate(),d=new Date(o.year,o.month+1,0).getDate(),l=new Date(o.year,o.month+2,0).getDate(),b=parseInt(s+d+l),p=Math.abs(Math.round((o.pick-a.pick)/864e5)),u="end"===e?parseInt(p-s):parseInt(p-d-l),f="end"===e?parseInt(p-s+b):parseInt(p-l+b);if("end"===e&&p<s)u=wceb.bookingCustomDuration,f=parseInt(p+d+l);if("start"===e&&u<l)u=wceb.bookingCustomDuration,f=parseInt(p+d+s);if(u<0&&(u=0),u<wceb.bookingCustomDuration)u=wceb.bookingCustomDuration;else{var m,w=[];for(m=0;m<=u;m+=wceb.bookingCustomDuration)w.push(m);u=w.slice(-1)[0]}"days"===wceb.calcMode&&--u;var k=[1,2,3,4,5,6,7];for(first=!1,r=u;r<=f;r+=wceb.bookingCustomDuration){var _=new Date(a.year,a.month,a.date);if("start"===e?_.setDate(n.getDate()-r):"end"===e&&_.setDate(n.getDate()+r),dateToEnable=wceb.createDateObject(_),"end"===e&&dateToEnable.obj>i.obj||"start"===e&&dateToEnable.obj<i.obj)break;if(void 0!==c&&0<c.length)var g=wceb.checkIf.isDisabled(c,dateToEnable);!0!==g&&k.push([dateToEnable.year,dateToEnable.month,dateToEnable.date,"inverted"])}return t.disable=c.concat(k),!1},wceb.formatPrice=function(e){return formatted_price=accounting.formatMoney(e,{symbol:wceb_object.currency_format_symbol,decimal:wceb_object.currency_format_decimal_sep,thousand:wceb_object.currency_format_thousand_sep,precision:wceb_object.currency_format_num_decimals,format:wceb_object.currency_format}),formatted_price},wceb.setPrice=function(){var e=$variation_input.val();children=wceb.get.childrenIds(),a={};p.fn.pickadate.defaults.format;a.startFormat=pickerStart.get("select","yyyy-mm-dd"),a.endFormat=pickerEnd.get("select","yyyy-mm-dd");var t=wceb.get.additionalCosts("each","raw-price"),r={security:document.getElementsByName("_wceb_nonce")[0].value,product_id:p('input[name="add-to-cart"], button[name="add-to-cart"]').val(),quantity:$qty_input.val(),variation_id:e,children:children,start_format:a.startFormat,end_format:a.endFormat,additional_cost:t};p("form.cart, form.bundle_form").fadeTo("400","0.6").css("cursor","wait"),p.post(ajax_url.toString().replace("%%endpoint%%","set_booking_session"),r,function(e){if(p(".woocommerce-error, .woocommerce-message").remove(),fragments=e.fragments,error=e.error,error)return p(".wceb_picker_wrap").prepend('<div class="wceb_error woocommerce-error">'+error+"</div>"),wceb.pickers.reset(),$reset_dates.hide(),p("form.cart, form.bundle_form").fadeTo(0,"1").css("cursor","auto"),!1;if(fragments){p.each(fragments,function(e,t){p(e).replaceWith(t)});var t=wceb.formatPrice(fragments.booking_price),a='<span class="woocommerce-Price-amount amount">'+t+"</span>"+wceb_object.price_suffix;if(""!==fragments.booking_regular_price){a='<del><span class="woocommerce-Price-amount amount">'+wceb.formatPrice(fragments.booking_regular_price)+wceb_object.price_suffix+'</span></del> <ins><span class="woocommerce-Price-amount amount">'+t+wceb_object.price_suffix+"</span></ins>";$booking_price.attr("data-booking_regular_price",fragments.booking_regular_price)}else $booking_price.attr("data-booking_regular_price",fragments.booking_price);$booking_price.attr("data-booking_price",fragments.booking_price).find(".price").html(a),wceb.session=fragments.session}$body.trigger("update_price",[r,e]),p("form.cart, form.bundle_form").fadeTo(0,"1").css("cursor","auto")})},wceb.picker.set=function(){var e=$variation_input.val();children=wceb.get.childrenIds(),a.startFormat=pickerStart.get("select","yyyy-mm-dd");var r={security:document.getElementsByName("_wceb_nonce")[0].value,product_id:p('input[name="add-to-cart"], button[name="add-to-cart"]').val(),quantity:$qty_input.val(),variation_id:e,children:children,start_format:a.startFormat,additional_cost:wceb.get.additionalCosts("each","raw-price")};p("form.cart, form.bundle_form").fadeTo("400","0.6").css("cursor","wait"),p.post(ajax_url.toString().replace("%%endpoint%%","set_booking_session"),r,function(e){if(p(".woocommerce-error, .woocommerce-message").remove(),fragments=e.fragments,error=e.error,error)return p(".wceb_picker_wrap").prepend('<div class="wceb_error woocommerce-error">'+error+"</div>"),wceb.pickers.reset(),$reset_dates.hide(),p("form.cart, form.bundle_form").fadeTo(0,"1").css("cursor","auto"),!1;if(fragments){if(p.each(fragments,function(e,t){p(e).replaceWith(t)}),fragments.booking_price){var t=wceb.formatPrice(fragments.booking_price),a='<span class="woocommerce-Price-amount amount">'+t+"</span>"+wceb_object.price_suffix;if(""!==fragments.booking_regular_price){a='<del><span class="woocommerce-Price-amount amount">'+wceb.formatPrice(fragments.booking_regular_price)+'</span></del> <ins><span class="woocommerce-Price-amount amount">'+t+"</span></ins>";$booking_price.attr("data-booking_regular_price",fragments.booking_regular_price)}$booking_price.attr("data-booking_price",fragments.booking_price).find(".price").html(a)}wceb.session=fragments.session}$body.trigger("update_price",[r,e]),p("form.cart, form.bundle_form").fadeTo(0,"1").css("cursor","auto")})},wceb.picker.close=function(e,t){if(p(document.activeElement).blur(),"two"===wceb.dateFormat){var a=e.get("select"),r=t.get("select");wceb.checkIf.dateIsSet(a)&&!wceb.checkIf.dateIsSet(r)&&setTimeout(function(){t.open()},250)}},wceb.pickers.init=function(){pickerStartItem.disable=[],"two"===wceb.dateFormat&&(pickerEndItem.disable=[]);var e=wceb.get.firstAvailableDates(),t=e.start,a=wceb.createDateObject(wceb.maxOption),r=wceb.createDateObject(new Date(t.year,t.month,1));if(pickerStartItem.clear=null,pickerStartItem.select=void 0,pickerStartItem.min=t,pickerStartItem.max=a,pickerStartItem.highlight=t,pickerStartItem.view=r,pickerStart.$node.val(""),"two"===wceb.dateFormat){var c=e.end,i=wceb.createDateObject(new Date(c.year,c.month,1));pickerEndItem.clear=null,pickerEndItem.select=void 0,pickerEndItem.min=c,pickerEndItem.max=a,pickerEndItem.highlight=c,pickerEndItem.view=i,pickerEnd.$node.val("")}return $add_to_cart_button.addClass("disabled dates-selection-needed"),!1},wceb.pickers.render=function(e){$body.trigger("pickers_init",e),pickerStart.render(),pickerEnd.render(),$body.trigger("after_pickers_init",e)},wceb.pickers.reset=function(){if(wceb.pickers.init(),"variable"===wceb.productType){var e=$variation_input.val(),t={};t.variation_id=e,wceb.pickers.render(t)}else if("grouped"===wceb.productType||"bundle"===wceb.productType){var a=$reset_dates.attr("data-ids");""!==a&&(a=JSON.parse(a)),wceb.pickers.render(a)}else wceb.pickers.render()},wceb.pickers.clearSecond=function(e,t,a){var r=a.component.item,c=wceb.get.firstAvailableDates()[t],i=wceb.createDateObject(wceb.maxOption),n=wceb.createDateObject(new Date(c.year,c.month,1));r.disable=[],r.min=c,r.max=i,null===a.get("select")&&(r.highlight=c,r.view=n),$body.trigger("clear_"+e+"_picker",r),a.render()},wceb.pickers.set=function(e,t,a,r){var c=t.get("select"),i=a.get("select");if(null!==c){var n="start"===e?"superior":"inferior",o="start"===e?"plus":"minus",s=c.pick,d=wceb.get.minAndMax(c,o),l=d.min,b=d.max,p="start"===e?b:l;b=b||wceb.maxOption;var u=wceb.get.closestDisabled(s,a,n);if(u){var f=new Date(u);if("start"===e&&u<p||"end"===e&&p<u)p=f}l="start"===e?wceb.createDateObject(l):wceb.createDateObject(p),b="start"===e?wceb.createDateObject(p):wceb.createDateObject(b);var m=wceb.createDateObject(new Date(l.year,l.month,1));r.min=l,r.max=b,r.view=m,null==i&&(r.highlight=l),$body.trigger("set_"+e+"_picker",[r,s]),a.render(),wceb.checkIf.datesAreSet()&&wceb.setPrice()}},pickerStart.on({render:function(){pickerStart.$root.find(".picker__header").prepend('<div class="picker__title">'+wceb_object.start_text+"</div>")},set:function(e){void 0!==e.clear&&null===e.clear&&("two"===wceb.dateFormat&&(wceb.pickers.clearSecond("start","end",pickerEnd),wceb.checkIf.dateIsSet("end")||$reset_dates.hide()),a.startFormat=null,$body.trigger("clear_start_date")),"two"===wceb.dateFormat&&wceb.checkIf.dateIsSet(e.select)?(wceb.pickers.set("start",pickerStart,pickerEnd,pickerEndItem),$reset_dates.show()):"one"===wceb.dateFormat&&wceb.checkIf.dateIsSet(e.select)&&wceb.picker.set()},close:function(){wceb.picker.close(pickerStart,pickerEnd)}}),pickerEnd.on({render:function(){pickerEnd.$root.find(".picker__header").prepend('<div class="picker__title">'+wceb_object.end_text+"</div>")},set:function(e){return void 0!==e.clear&&null===e.clear&&(wceb.pickers.clearSecond("end","start",pickerStart),wceb.checkIf.dateIsSet("start")||$reset_dates.hide(),a.endFormat=null,$body.trigger("clear_end_date")),"two"===wceb.dateFormat&&wceb.checkIf.dateIsSet(e.select)&&(wceb.pickers.set("end",pickerEnd,pickerStart,pickerStartItem),$reset_dates.show()),!1},close:function(){wceb.picker.close(pickerEnd,pickerStart)}}),$body.on("pickers_init",function(e,t){var a=wceb.get.firstAvailableDates(),r=a.start;if(pickerStartItem.view=wceb.createDateObject(new Date(r.year,r.month,1)),pickerStartItem.highlight=r,"two"===wceb.dateFormat){var c=a.end;pickerEndItem.view=wceb.createDateObject(new Date(c.year,c.month,1)),pickerEndItem.highlight=c,pickerEndItem.min=c}return!1}),pickerStart.on("before_rendering",function(){if("two"===wceb.dateFormat){var e=pickerEnd.get("select");startPickerDisabled=pickerStartItem.disable,wceb.checkIf.dateIsSet(e)&&"days"!==wceb.bookingDuration&&1<wceb.bookingCustomDuration&&wceb.applyBookingDuration("start",pickerStartItem,e)}}),pickerStart.on("after_rendering",function(){"two"===wceb.dateFormat&&(pickerStartItem.disable=startPickerDisabled)}),pickerEnd.on("before_rendering",function(){var e=pickerStart.get("select");endPickerDisabled=pickerEndItem.disable,wceb.checkIf.dateIsSet(e)&&"days"!==wceb.bookingDuration&&1<wceb.bookingCustomDuration&&wceb.applyBookingDuration("end",pickerEndItem,e)}),pickerEnd.on("after_rendering",function(){pickerEndItem.disable=endPickerDisabled}),$cart.on("change",'input[name="quantity"]',function(e){if("two"===wceb.dateFormat&&wceb.checkIf.datesAreSet())wceb.setPrice();else if("one"===wceb.dateFormat&&wceb.checkIf.dateIsSet("start"))wceb.picker.set();else{var t=wceb.formatPrice(wceb.get.basePrice());$booking_price.find(".price .amount").html(t),formatted_regular_price=wceb.formatPrice(wceb.get.regularPrice()),$booking_price.find(".price del .amount").html(formatted_regular_price)}e.stopPropagation()}),$body.on("update_price",function(){$add_to_cart_button.removeClass("disabled dates-selection-needed")}),p(".product-addon input, .product-addon textarea, .product-addon select, .product-addon input.qty, .wc-pao-addon input, .wc-pao-addon textarea, .wc-pao-addon select, .wc-pao-addon-image-swatch, .wc-pao-addon input.qty").on("woocommerce-product-addons-update",function(){if("two"===wceb.dateFormat&&wceb.checkIf.datesAreSet())wceb.setPrice();else if("one"===wceb.dateFormat&&wceb.checkIf.dateIsSet("start"))wceb.picker.set();else{var e=wceb.formatPrice(wceb.get.basePrice());$booking_price.find(".price .amount").html(e),formatted_regular_price=wceb.formatPrice(wceb.get.regularPrice()),$booking_price.find(".price del .amount").html(formatted_regular_price)}}),$body.on("clear_start_date clear_end_date",function(){wceb.clearBookingSession()}),$add_to_cart_button.on("click",function(e){$this=p(this),!$this.is(".disabled,.dates-selection-needed")||$this.hasClass("wc-variation-selection-needed")||$this.hasClass("wc-variation-is-unavailable")||(e.preventDefault(),window.alert(wceb_object.select_dates_message),e.stopPropagation())}),$reset_dates.on("click",function(e){e.preventDefault(),wceb.pickers.reset(),wceb.clearBookingSession(),p(this).hide()}).hide()})}(jQuery);